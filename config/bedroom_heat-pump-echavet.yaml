#
# switched from the muart-group external_component to this on 2025-11-04, b/c the other broke things

substitutions:
  device_name: bedroom-heat-pump
  device_id: bedroom_heat_pump
  description: Primary bedroom heat pump
  name: Bedroom heat pump

packages:
  <<: !include_dir_named common
  #board: !include boards/lolin_c3_mini.yaml
  board: !include boards/lolin_s3_mini.yaml

external_components:
  #- source: github://geoffdavis/esphome-mitsubishiheatpump@develop # archived/depricated use echavet's which maintains same functionality 
  - source: github://echavet/MitsubishiCN105ESPHome # https://github.com/echavet/MitsubishiCN105ESPHome

#esphome:
#  # Set platform options to use c++ 17 instead of 11
#  platformio_options:
#    build_unflags:
#      - "-std=gnu++11"
#    build_flags:
#      - "-std=gnu++17"
  #on_boot:
  #  then:
  #    - delay: 2s
  #    - light.turn_on:
  #        id: ${device_id}_led
  #        brightness: 15%

# only for s3-mini, on c3-mini tx pin is shared with LED
esphome:
  # turn on onboad led to red w/ brightness % (kind of an "on" status indicator)
  # (dimmest is 11%, 12% turns on more reliably, off â‰¤ 10%, reducing each color by same amount seems to maybe reduce brightness ðŸ¤·)
  # at some may use lambdas in the climate component to set colors per mode (cool/heat/idleq)
  on_boot:
    priority: 600 # default
    then:
      - delay: 2s
      - light.turn_on:
          id: onboard_led
          brightness: 25%
          red: 0%
          green: 100%
          blue: 0%
      - delay: 7s
      - light.turn_on:
          id: onboard_led
          brightness: 11%
          red: 50%
          green: 0%
          blue: 50%
          #red: 100%
          #green: 0%
          #blue: 100%
light:
  <<: !include components/onboard_ws2812.yaml


# this works around a bug introduced in HA 2025.5.0
sensor:
  - platform: uptime
    name: Uptime

uart:
  id: hp_uart
  baud_rate: 2400
  #baud_rate: 4800
  #tx_pin: 12  # dev kit v1 tx/rx
  #rx_pin: 13
  tx_pin: GPIO18 # s3 mini
  rx_pin: 
    number: GPIO16
    #mode:   # the need for this looks like it was resolved with a fallback implemented in the component in v1.5
    #  pullup: true
    #  input: true
  #tx_pin: GPIO7 # c3 mini
  #rx_pin: GPIO6

climate:
  #- platform: mitsubishi_heatpump
  - platform: cn105
    # using "name: none" uses friendly name
    #name: "${name}"
    name: none
    id: ${device_id}_climate
    update_interval: 2s
    visual:
      temperature_step:
        target_temperature: 1
        current_temperature: 0.5
    # Various optional sensors, not all sensors are supported by all heatpumps
    compressor_frequency_sensor:
      name: Compressor Frequency
      entity_category: diagnostic
      disabled_by_default: true
    outside_air_temperature_sensor:
      name: Outside Air Temp
      disabled_by_default: true
    vertical_vane_select:
      name: Vertical Vane
      disabled_by_default: false
    horizontal_vane_select:
      name: Horizontal Vane
      disabled_by_default: true
    isee_sensor:
      name: ISEE Sensor
      disabled_by_default: true
    stage_sensor:
      name: Stage
      #use_as_operating_fallback: false  # set to true if your unit doesn't provide activity indicator ([#277](https://github.com/echavet/MitsubishiCN105ESPHome/issues/277))
      entity_category: diagnostic
      disabled_by_default: true
    sub_mode_sensor:
      name: Sub Mode
      entity_category: diagnostic
      disabled_by_default: true
    auto_sub_mode_sensor:
      name: Auto Sub Mode
      entity_category: diagnostic
      disabled_by_default: true
    input_power_sensor:
      name: Input Power
      disabled_by_default: true
    kwh_sensor:
      name: Energy Usage
      disabled_by_default: true
    runtime_hours_sensor:
      name: Runtime Hours
      entity_category: diagnostic
      disabled_by_default: true
